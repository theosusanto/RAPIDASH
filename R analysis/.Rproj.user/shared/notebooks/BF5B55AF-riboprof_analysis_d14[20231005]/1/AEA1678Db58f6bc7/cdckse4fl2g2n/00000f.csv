"0","library(repr)"
"0","options(repr.plot.width=4, repr.plot.height=4)"
"0",""
"0","# shortcut for finding the rowname corresponding to a gene"
"0","# EGR1"
"0","rownames(v_te$E)[grep('CDH1', rownames(v_te$E))]"
"1","[1]"
"1"," ""CDH1_ENSG00000039068_ENST00000261769""  "
"1"," ""PCDH17_ENSG00000118946_ENST00000377918"""
"1","
"
"1","[3]"
"1"," ""CDH10_ENSG00000040731_ENST00000264463"" "
"1"," ""CDH11_ENSG00000140937_ENST00000268603"" "
"1","
"
"1","[5]"
"1"," ""PCDH19_ENSG00000165194_ENST00000373034"""
"1"," ""PCDH10_ENSG00000138650_ENST00000264360"""
"1","
"
"1","[7]"
"1"," ""PCDH1_ENSG00000156453_ENST00000287008"" "
"1","
"
"0","# goi = c('COL9A3_ENSG00000092758_ENST00000649368',"
"0","#         'CDH1_ENSG00000039068_ENST00000261769',"
"0","#         'LEF1_ENSG00000138795_ENST00000265165')"
"0","# goi = 'LLPH_ENST00000266604'"
"0",""
"0","# norm_counts = 2^v_te$E[goi,]"
"0",""
"0","df_wide <- as_tibble(2^v_te$E) %>% mutate(gene = rownames(2^v_te$E), .before=1)"
"0","df_tall <- gather(df_wide, key = ""sample"", value = ""cpm"", -gene)"
"0","df_tall <- separate(df_tall, sample, c(""genotype"", ""replicate"", ""fraction""))"
"0",""
"0","df_tall_te <- spread(df_tall, key = fraction, value = cpm)"
"0","df_tall_te$TE <- df_tall_te$RFP/df_tall_te$RNA"
"0","df_tall_te <- separate(df_tall_te, gene, c(""gene_name"", ""ensembl_gene"", ""transcript_id""),sep = ""_"", remove = FALSE, extra = ""drop"")"
"0","df_tall_te_only <- df_tall_te %>% "
"0","  dplyr::select(-RNA, -RFP) %>% "
"0","  pivot_wider(names_from = replicate, values_from = TE) %>% "
"0","  rowwise() %>% "
"0","  mutate(ave_te = mean(c(rep1, rep2, rep3), na.rm = TRUE),"
"0","         std_te = sd(c(rep1, rep2, rep3), na.rm = TRUE))"
"0","summary <- df_tall_te_only %>% "
"0","  pivot_longer(cols = c(rep1, rep2, rep3), names_to = c(""replicate""), values_to = ""values"")"
"0",""
"0","# Create an empty data frame to store the t-test results"
"0","t_test_results <- data.frame(transcript_id = character(0),"
"0","                              p_value = numeric(0))"
"0",""
"0","# Perform t-test for each 'transcript_id'"
"0","for (tid in unique(summary$transcript_id)) {"
"0","  subset_data <- summary %>% filter(tid == .data$transcript_id)"
"0","  t_test_result <- t.test(values ~ genotype, data = subset_data)"
"0","  t_test_results <- rbind(t_test_results, "
"0","                          data.frame(transcript_id = tid, p_value = t_test_result$p.value))"
"0","}"
"0",""
"0","summary_ttest <- summary %>% "
"0","  dplyr::select(-values, -replicate) %>% "
"0","  distinct() %>% "
"0","  pivot_wider(names_from = genotype, values_from = c(ave_te, std_te)) %>% "
"0","  mutate(diff_te = ave_te_Nterm/ave_te_wt,"
"0","         downregulated = ifelse(diff_te > 1, 0, 1)) %>% "
"0","  full_join(t_test_results, by = ""transcript_id"")"
"0","summary_ttest <- summary_ttest %>% "
"0","  arrange(p_value)"
"0",""
"0","# write.csv(summary_ttest, file = ""TE_with_ttest.csv"", row.names = FALSE)"
"0",""
"0","# df_tall$lines = factor(df_tall$genotype, levels=c('wt', 'Nterm'))"
"0","# df_tall$xlabels = factor(paste(df_tall$genotype, df_tall$fraction, sep=""_""),"
"0","#                          levels=c('wt_RNA', 'wt_RFP', 'Nterm_RNA', 'Nterm_RFP'))"
"0",""
"0","#palette = c('purple1', 'purple4', 'magenta', 'magenta4', 'gray50', 'gray20')"
"0",""
"0","# subset_tids <- c('CSPG4_ENSG00000173546_ENST00000308508',"
"0","#                  'RHOBTB2_ENSG00000008853_ENST00000251822',"
"0","#                  'FNTA_ENSG00000168522_ENST00000302279',"
"0","#                  'MYORG_ENSG00000164976_ENST00000297625',"
"0","#                  'PABPC5_ENSG00000174740_ENST00000312600')"
"0",""
"0","# subset_tids <- c('PCDHB5_ENSG00000113209_ENST00000231134',"
"0","#                  'CDH5_ENSG00000179776_ENST00000341529',"
"0","#                  'PCOLCE2_ENSG00000163710_ENST00000295992',"
"0","#                  'PCDHA10_ENSG00000250120_ENST00000307360',"
"0","#                  'RAPGEF6_ENSG00000158987_ENST00000509018')"
"0",""
"0","subset_tids <- c('CSPG4_ENSG00000173546_ENST00000308508',"
"0","                 'RHOBTB2_ENSG00000008853_ENST00000251822',"
"0","                 'TTC23_ENSG00000103852_ENST00000394132',"
"0","                 'MYORG_ENSG00000164976_ENST00000297625',"
"0","                 'SEMA3A_ENSG00000075213_ENST00000265362')"
"0",""
"0","plot <- summary %>% "
"0","  dplyr::filter(gene %in% subset_tids)"
"0","plot$genotype <- factor(plot$genotype, levels=c('wt', 'Nterm'))"
"0",""
"0","custom_fill <- c(""gray80"", ""gray40"")"
"0",""
"0","ggplot(plot, aes(x=genotype, y=ave_te, fill = genotype)) + "
"0","  geom_bar(stat = ""identity"", position = ""dodge"") +"
"0","  geom_errorbar("
"0","    aes(ymin = ave_te - std_te, ymax = ave_te + std_te),"
"0","    position = position_dodge(width = 0.8),"
"0","    width = 0.2"
"0","  ) +"
"0","  facet_wrap (~ gene_name, scales = ""free_y"", ncol = 5) +"
"0","  scale_fill_manual(values = custom_fill) +"
"0","  theme_classic() + "
"0","  theme(legend.position = 'none', axis.text.x = element_text(angle = 90)) +"
"0","  expand_limits(y=0)"
